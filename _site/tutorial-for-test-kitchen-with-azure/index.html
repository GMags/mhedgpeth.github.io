<!DOCTYPE html>
<html class="no-js">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>hedge-ops | Tutorial for Test Kitchen with Azure</title>
    <meta name="description" content="As I wrote in the last post, Test Kitchen as one of the things that attracted me to Chef. There was a problem, though: running Windows on virtual machines au...">

    <link rel="stylesheet" href="/css/main.css">

    <link rel="canonical" href="http://hedge-ops.com/tutorial-for-test-kitchen-with-azure/">
    <link rel="alternate" type="application/rss+xml" title="hedge-ops" href="http://hedge-ops.com/feed.xml" />

    <!--[if lt IE 9]>
        <script src="/js/vendor/html5shiv.min.js"></script>
    <![endif]-->
</head>


  <body class="">
    <!-- if the user has javascript disabled they can still use the menu -->
<noscript>
    <div class="no-js-menu clearfix">
        <ul>
            
                <li><i class="fa fa-home"></i><a href="/">Home</a></li>
            
                <li><i class="fa fa-anchor"></i><a href="/about">About</a></li>
            
                <li><i class="fa fa-plane"></i><a href="/contact">Contact</a></li>
            
                <li><i class="fa fa-user"></i><a href="/author/michelle">Author</a></li>
            
        </ul>
    </div>
</noscript>
<!-- end no script -->

    <header class="hero-image" style="background-image: url(/img/.jpg);">
    <span class="menu-trigger animated fadeInDown">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
    </span>

    <div id="menu-target">
    <ul>
        
            <li><i class="fa fa-home"></i><a href="/">Home</a></li>
        
            <li><i class="fa fa-anchor"></i><a href="/about">About</a></li>
        
            <li><i class="fa fa-plane"></i><a href="/contact">Contact</a></li>
        
            <li><i class="fa fa-user"></i><a href="/author/michelle">Author</a></li>
        
    </ul>
</div>

</header>

<main class="container">
    <div class="row">
        <div class="col-xs-12 single-content">
            <p class="meta">
                <a href=""></a> in <a href='/category/insights'>Insights</a> <i class="link-spacer"></i> <i class="fa fa-bookmark"></i>  minutes
            </p>

            <h1>Tutorial for Test Kitchen with Azure</h1>

            <p>As I wrote in <a href="http://hedge-ops.com/test-kitchen-required-not-optional/ ‎" target="_blank">the last post</a>, Test Kitchen as one of the <a href="http://hedge-ops.com/learning-chef-book-review/" target="_blank">things that attracted me to Chef</a>. There was a problem, though: running Windows on virtual machines automatically is difficult.</p>

<p>I’ve spent quite a bit of time trying to create a vagrant image <a href="http://www.hurryupandwait.io/blog/creating-windows-base-images-for-virtualbox-and-hyper-v-using-packer-boxstarter-and-vagrant" target="_blank">using Matt Wrock’s excellent blog</a> as a resource, and haven’t quite gotten it there yet. Plus, if I go the vagrant route, people have to have powerful machines on which to run test kitchen. The more I worked through that option, the more I because discouraged and dismayed that this may just never work for us.</p>

<p>And then I discovered azure.<!--more--></p>

<p>Don’t get me wrong: I’m not a Microsoft fanboy. But there are some great advantages to going this route:</p>

<ol>
  <li>Through my Microsoft-friendly workplace I get a MSDN Subscription, <a href="https://azure.microsoft.com/en-us/pricing/member-offers/msdn-benefits/" target="_blank">with which I get $50/month credit to use azure</a>. So this is free, and I can run test kitchen on not-my compute resources.</li>
  <li>Microsoft by definition is going to get Windows images right. So I don’t have to fight it anymore. I can just use it. It just works, just like it should.</li>
  <li><a href="http://stuartpreston.net/" target="_blank">Stuart Preston</a> wrote a plugin for me that gets anyone past the learning curve very quickly. With this plugin you don’t have to really know anything about azure to use it for test kitchen</li>
</ol>

<p>These reasons are so compelling, this is what our teams will be going with in the coming months. It’s critical that everyone be able to run test kitchen easily, and azure gives us the best shot at doing that without a lot of drama.</p>

<p>Setting up was easy:</p>

<ol>
  <li><a href="http://blogs.msdn.com/b/msgulfcommunity/archive/2014/09/15/how-to-activate-azure-benefit-for-msdn-subscribers.aspx" target="_blank">Activate your subscription from your MSDN account</a></li>
  <li><a href="https://azure.microsoft.com/en-us/documentation/articles/xplat-cli-install/" target="_blank">Install the Azure CLI for Windows</a></li>
  <li>Follow the directions <a href="https://github.com/pendrica/kitchen-azurerm" target="_blank">on the kitchen-azurerm main page</a> to set up a Security Principal, Tenant, Password, and configure it in your user directory</li>
  <li>In a simple cookbook, create <a href="https://gist.github.com/mhedgpeth/a70ef0a7edf01d9c7ed2">a simple kitchen.yml file</a> like this:</li>
</ol>

<pre>---
driver:
 name: azurerm

driver_config:
 subscription_id: &lt;%= ENV['AZURE_SUBSCRIPTION_ID'] %&gt;
 location: 'South Central US'
 machine_size: 'Standard_D1'

provisioner:
 name: chef_zero

verifier:
 name: inspec

platforms:
 - name: windows2012-r2
 driver_config:
 image_urn: MicrosoftWindowsServer:WindowsServer:2012-R2-Datacenter:latest
 transport:
 name: winrm
 - name: centos71
 driver_config:
 image_urn: OpenLogic:CentOS:7.1:latest

suites:
 - name: default
 run_list:
 - recipe[contributors::default]
 attributes:</pre>

<p>It’s really that simple. Now I can run test kitchen commands:</p>

<div class="table-responsive">
  <table style="width:100%; " class="easy-table easy-table-default " border="0">
    <tr>
      <th>
        command
      </th>
      
      <th>
        description
      </th>
    </tr>
    
    <tr>
      <td>
        kitchen create
      </td>
      
      <td>
        creates azure infrastructure for running, powers on machines
      </td>
    </tr>
    
    <tr>
      <td>
        kitchen converge
      </td>
      
      <td>
        does kitchen create if needed, will converge the node using chef
      </td>
    </tr>
    
    <tr>
      <td>
        kitchen verify
      </td>
      
      <td>
        does create and converge if needed, runs the tests that you've written
      </td>
    </tr>
    
    <tr>
      <td>
        kitchen test
      </td>
      
      <td>
        does everything: create, converge, verify
      </td>
    </tr>
    
    <tr>
      <td>
        kitchen destroy
      </td>
      
      <td>
        don't forget this one; it removes the resources
      </td>
    </tr>
  </table>
</div>

<p>There you have it, go through those easy steps and you have Kitchen working with Azure.</p>


        </div><!-- main-content/col -->
    </div> <!--/row -->

</main> <!-- /container -->

<footer class="single">
    <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-2">
            <img src="/img/.jpg" class="user-icon " alt="user-image">
        </div>
        <div class="col-xs-12 col-sm-6">
            <div class="category-list">
                <p>Published <span>Mar 4, 2016</span></p>
                <p><a href=""></a> in <a href='/category/insights'>Insights</a></p>

                <div class="other-catergories">
                    <h3>Also found in</h3>

                    <ul>
                        
                        <li>
                            <a href='/category/insights'>Insights</a>
                            
                        </li>
                        
                    </ul>
                </div>

            </div>
        </div><!-- end col -->
        <div class="col-xs-12 col-sm-4">
            <div class="social">
                <p>Share this article</a>
                <div class="social-links">
                    <a class="social-icon" href="#" data-platform="twitter" data-message="" data-url="http://hedge-ops.com/tutorial-for-test-kitchen-with-azure/"><i class="fa fa-twitter"></i></a>

                    <a class="social-icon" href="#" data-platform="facebook" data-message="" data-url="http://hedge-ops.com/tutorial-for-test-kitchen-with-azure/"><i class="fa fa-facebook-official"></i></a>
                    <a class="social-icon" data-platform="mail"  href="mailto:mhedgpeth-hedge-ops-email@gmail.com?body=http://hedge-ops.com/tutorial-for-test-kitchen-with-azure/"><i class="fa fa-envelope"></i></a>
                </div>
            </div>
        </div>
    </div><!-- end row -->
</div>


    
</footer>


    <script src='/js/vendor/modernizr.custom.32229-2.8-respondjs-1-4-2.js'></script>
    <script src="/js/vendor/jquery-1.11.2.min.js"></script>
    <script src='/js/vendor/jquery.jpanelmenu.min.js'></script>
    <script type='application/javascript' src='/js/vendor/fastclick.min.js'></script>
    
    <script src=' /js/main.js'></script>
  </body>

</html>
